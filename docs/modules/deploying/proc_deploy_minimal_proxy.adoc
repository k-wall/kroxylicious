// DO NOT EDIT THIS FILE DIRECTLY
// You'll be wasting your time because it is auto-generated from the proc descriptor

[id='deploy_minimal_proxy-{context}']

= Deploying a minimal proxy instance

[role="_abstract"]
This procedure shows how to deploy a basic Kroxylicious proxy, without any filters, 
accessible using plain TCP networking to clients in the same Kubernetes cluster.


This example assumes you&#39;re running Kafka in Kubernetes using Strimzi.
Specifically, it makes the assumption that you have a Strimzi-managed Kafka cluster 
running in the `kafka` namespace, and that the hostname `my-cluster-cluster-ip.my-proxy.svc.cluster.local:9292`
can be used as a bootstrap server for both the `KafkaService` and the Kafka clients that 
will be used to verify the proxy is working.


.Prerequisites

* xref:have_a_kubectl-operator[Access to a Kubernetes cluster using `kubectl`]
* xref:have_a_target_kafka_cluster-operator[A backend Kafka cluster to be proxied]
* xref:deploy_kroxy_operator-operator[The Kroxylicious operator must be deployed]

.Procedure

. Install the `simple` example.
+
[source,shell]
----
kubectl apply -f examples/simple/
----

. Wait for the proxy to become `Ready`.
+
[source,shell]
----
kubectl wait -n my-proxy kafkaproxy/simple --for=condition=Ready=True --timeout=300s
----


.Verification

. Create a namespace to run the clients in
+
[source,shell]
----
kubectl create namespace kafka-client
----

. Run a producer to send some records through the proxy to the Kafka cluster
+
[source,shell]
----
kubectl -n kafka-client run java-kafka-producer -ti --image=quay.io/strimzi/kafka:0.38.0-kafka-3.6.0 
--rm=true --restart=Never 
-- 
bin/kafka-verifiable-producer.sh 
--bootstrap-server=my-cluster-cluster-ip.my-proxy.svc.cluster.local:9292 
--topic=test-topic 
--max-messages=10

----

. Run a consumer to retrieve the records you sent
+
[source,shell]
----
kubectl -n kafka-client run java-kafka-consumer -ti --image=quay.io/strimzi/kafka:0.38.0-kafka-3.6.0 
--rm=true --restart=Never -- 
bin/kafka-verifiable-consumer.sh 
--bootstrap-server=my-cluster-cluster-ip.my-proxy.svc.cluster.local:9292
--group-id=from-proxy
--topic=test-topic 
--reset-policy=earliest 
--max-messages=10

----

. Optionally, you can run a consumer against the backend Kafka cluster, to prove the records went to 
the cluster.
+
In this command notice that value of `--bootstrap-server` is the bootstrap server for the Kafka cluster, 
not the proxy, and that the `--group-id` is different from one used in the previous step.

+
[source,shell]
----
kubectl -n kafka-client run java-kafka-consumer -ti --image=quay.io/strimzi/kafka:0.38.0-kafka-3.6.0 
--rm=true --restart=Never 
-- 
bin/kafka-verifiable-consumer.sh 
--bootstrap-server=my-cluster-kafka-bootstrap.kafka.svc:9092
--group-id=from-cluster
--topic=test-topic 
--reset-policy=earliest 
--max-messages=10

----

. Clean up the resources you used you verification.
+
Delete the Kafka topic you used.
+
[source,shell]
----
kubectl -n kafka-client run java-kafka-admin -ti --image=quay.io/strimzi/kafka:0.38.0-kafka-3.6.0 
--rm=true --restart=Never 
--
bin/kafka-topics.sh 
--bootstrap-server=my-cluster-kafka-bootstrap.kafka.svc:9092 
--topic test-topic 
--delete

----
+
Delete the Kafka consumer group you used to consume through the proxy.
+
[source,shell]
----
kubectl -n kafka-client run java-kafka-admin -ti --image=quay.io/strimzi/kafka:0.38.0-kafka-3.6.0 
--rm=true --restart=Never 
-- 
bin/kafka-consumer-groups.sh 
--bootstrap-server=my-cluster-kafka-bootstrap.kafka.svc:9092 
--group=from-proxy 
--delete

----
+
Delete the Kafka consumer group you used to consume directly from the Kafka cluster.
+
[source,shell]
----
kubectl -n kafka-client run java-kafka-admin -ti --image=quay.io/strimzi/kafka:0.38.0-kafka-3.6.0 
--rm=true --restart=Never 
-- 
bin/kafka-consumer-groups.sh 
--bootstrap-server=my-cluster-kafka-bootstrap.kafka.svc:9092 
--group=from-cluster 
--delete

----
+
Finally, delete the Kubernetes namespace you created the client pods in.
+
[source,shell]
----
kubectl delete namespace kafka-client
----


